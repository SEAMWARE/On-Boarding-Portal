<div class="page-container">
    <mat-toolbar color="primary" class="main-header mat-elevation-z4">
        <div class="header-container">
            <div class="brand">
                <mat-icon>security</mat-icon>
                <span>Onboarding Portal</span>
            </div>
        </div>
    </mat-toolbar>
    <div class="onboarding-wrapper">
        <mat-card class="main-container animate-fade-in">

            <mat-tab-group animationDuration="400ms">

                <mat-tab>
                    <ng-template mat-tab-label>
                        <mat-icon class="tab-icon">add</mat-icon>
                        <span>REGISTER ENTITY</span>
                    </ng-template>
                    <div class="tab-content">
                        @if(!requestId) {
                        <header class="section-header">
                            <h2>Organization Details</h2>
                            <p>Complete the administrative profile to initialize the data space integration.</p>
                        </header>

                        <form [formGroup]="registrationForm" class="form-grid">
                            <mat-form-field appearance="outline">
                                <mat-label>Legal Entity Name</mat-label>
                                <input matInput formControlName="name" placeholder="e.g. Global Data Solutions Ltd.">
                                <mat-icon matSuffix>business</mat-icon>
                            </mat-form-field>

                            <mat-form-field appearance="outline">
                                <mat-label>Administrative Contact Email</mat-label>
                                <input matInput formControlName="email" type="email"
                                    placeholder="compliance@entity.com">
                                <mat-icon matSuffix>alternate_email</mat-icon>
                            </mat-form-field>

                            <mat-form-field appearance="outline">
                                <mat-label>Decentralized Identifier (DID)</mat-label>
                                <input matInput formControlName="did" placeholder="did:web:domain.com">
                                <mat-icon matSuffix>fingerprint</mat-icon>
                                <mat-hint>Leaving this field empty will trigger automated DID generation.</mat-hint>
                            </mat-form-field>

                            <div class="upload-zone">
                                <p>Legal Evidence & Proof of Identity (PDF, PNG)</p>
                                <button type="button" mat-stroked-button color="primary" (click)="fileInput.click()">
                                    <mat-icon>upload_file</mat-icon> SELECT DOCUMENTS
                                </button>
                                <input #fileInput type="file" (change)="onFileSelected($event)" hidden multiple>

                                @if(selectedFiles.length > 0) {
                                <div class="file-previews">
                                    @for(file of selectedFiles;track file.name) {
                                    <span class="file-tag">
                                        <mat-icon>verified</mat-icon> {{ file.name }}
                                    </span>
                                    }
                                </div>
                                }
                            </div>
                        </form>

                        <div class="actions-footer">
                            @if(isProcessing()) {
                            <mat-progress-bar mode="indeterminate"></mat-progress-bar>
                            }
                            <button mat-flat-button color="primary"
                                [disabled]="registrationForm.invalid || isProcessing()" (click)="submitRegistration()">
                                SUBMIT APPLICATION
                            </button>
                        </div>
                        } @else {
                        <div class="success-container animate-fade-in">
                            <h2>Submission Received</h2>
                            <p class="success-description">
                                The application has been successfully queued for review. A confirmation email has been
                                sent
                                to the administrative address provided. Please save the following Request ID to track
                                the onboarding status.
                            </p>

                            <div class="request-id-display">
                                <mat-form-field appearance="fill" class="id-input-field">
                                    <mat-label>Application Request ID</mat-label>
                                    <input matInput [value]="requestId" readonly #idInput>
                                    <button mat-icon-button matSuffix (click)="copyRequestId()"
                                        matTooltip="Copy to clipboard">
                                        <mat-icon>content_copy</mat-icon>
                                    </button>
                                    <mat-hint>Use this ID to track your application status in the "Track Progress"
                                        tab.</mat-hint>
                                </mat-form-field>
                            </div>
                        </div>
                        }
                    </div>
                </mat-tab>

                <mat-tab>
                    <ng-template mat-tab-label>
                        <mat-icon class="tab-icon">track_changes</mat-icon>
                        <span>TRACK PROGRESS</span>
                    </ng-template>

                    <div class="tab-content">
                        <div class="status-lookup-wrapper">
                            <mat-icon class="hero-icon">manage_history</mat-icon>
                            <h2>Resume Onboarding</h2>
                            <p>Retrieve the status of a previously submitted organization profile.</p>

                            <mat-form-field appearance="outline" style="width: 100%; margin-top: 24px;">
                                <mat-label>Application Tracking ID</mat-label>
                                <input matInput [(ngModel)]="trackingId" placeholder="REQ-XXXX-XXXX">
                                <button mat-icon-button matSuffix (click)="resumeApplication()"
                                    [disabled]="!trackingId">
                                    <mat-icon>search</mat-icon>
                                </button>
                            </mat-form-field>
                            @if(isProcessing()){
                            <mat-progress-bar mode="indeterminate" style="margin-top: 16px;"></mat-progress-bar>
                            }
                        </div>
                    </div>
                </mat-tab>

            </mat-tab-group>
        </mat-card>
    </div>
</div>